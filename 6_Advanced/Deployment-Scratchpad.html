<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Open Library Docs</title>
    <meta name="description" content="A new docs experience for Open Library">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/openlibrary-docs/assets/style.EBppSvHT.css" as="style">
    <link rel="preload stylesheet" href="/openlibrary-docs/vp-icons.css" as="style">
    
    <script type="module" src="/openlibrary-docs/assets/app.CMWjYADJ.js"></script>
    <link rel="preload" href="/openlibrary-docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/openlibrary-docs/assets/chunks/theme.C4jjDcLP.js">
    <link rel="modulepreload" href="/openlibrary-docs/assets/chunks/framework.BRQrZDXk.js">
    <link rel="modulepreload" href="/openlibrary-docs/assets/6_Advanced_Deployment-Scratchpad.md.DXoq1M6k.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/openlibrary-docs/" data-v-9f43907a><!--[--><!--]--><!----><span data-v-9f43907a>Open Library Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/openlibrary-docs/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Home</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/internetarchive/openlibrary" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/internetarchive/openlibrary" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 collapsible collapsed is-link" data-v-51288d80 data-v-0009425e><div class="item" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/index.html" data-v-0009425e><!--[--><h2 class="text" data-v-0009425e>1_Everyone</h2><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/Community-Call.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Community-Call</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/Google-Summer-of-Code.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Google-Summer-of-Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/Hacktoberfest.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Hacktoberfest</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/Home.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Home</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/Internationalization.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Internationalization</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/Open-Library-Community-Call-Minutes.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Open-Library-Community-Call-Minutes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/1_Everyone/Slack-Channels.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Slack-Channels</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 collapsible collapsed is-link" data-v-51288d80 data-v-0009425e><div class="item" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/index.html" data-v-0009425e><!--[--><h2 class="text" data-v-0009425e>2_Developers</h2><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><section class="VPSidebarItem level-1 collapsible collapsed" data-v-0009425e data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h3 class="text" data-v-0009425e>2_Frontend</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/2_Frontend/Frontend-Guide.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Frontend-Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/2_Frontend/Using-Vue.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Using-Vue</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-0009425e data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h3 class="text" data-v-0009425e>3_Backend</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/3_Backend/Endpoints.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Endpoints</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/3_Backend/General.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>General</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/3_Backend/Understanding-The-Data-Model.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Understanding-The-Data-Model</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/3_Backend/Writing-Bots.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Writing-Bots</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/CONTRIBUTING.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>CONTRIBUTING</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/Git-Cheat-Sheet.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Git-Cheat-Sheet</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-0009425e data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h3 class="text" data-v-0009425e>misc</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/misc/Docker.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/misc/Loading-Production-Book-Data.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Loading-Production-Book-Data</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/misc/OUTDATED-Getting-Started.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>OUTDATED-Getting-Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/misc/Searching-data-dumps-with-grep-and-jq.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Searching-data-dumps-with-grep-and-jq</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/2_Developers/misc/Testing.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Testing</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 collapsible collapsed" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>3_Designers</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/3_Designers/Design-Pattern-Library.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Design-Pattern-Library</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 collapsible collapsed" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>4_Librarians</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/4_Librarians/Creating-Community-Lists.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Creating-Community-Lists</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/4_Librarians/Guide-to-Identifiers.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Guide-to-Identifiers</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/4_Librarians/Library-Metadata-Standards.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Library-Metadata-Standards</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/4_Librarians/Mangled-MARC.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Mangled-MARC</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 collapsible collapsed" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>5_Projects</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Canonical-Books-Page.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Canonical-Books-Page</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Developing-the-Reading-Log.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Developing-the-Reading-Log</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Documentation.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Documentation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Lead:-Community-Coordinator.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Lead:-Community-Coordinator</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Lead:-Community-Librarian.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Lead:-Community-Librarian</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Library-Community-Congress-2019.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Library-Community-Congress-2019</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Orphaned-Editions-Planning.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Orphaned-Editions-Planning</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/5_Projects/Wikidata-Integration.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Wikidata-Integration</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 collapsible collapsed is-link has-active" data-v-51288d80 data-v-0009425e><div class="item" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/index.html" data-v-0009425e><!--[--><h2 class="text" data-v-0009425e>6_Advanced</h2><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-0009425e><span class="vpi-chevron-right caret-icon" data-v-0009425e></span></div></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Anti-Spam-Tools.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Anti-Spam-Tools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Component-Library.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Component-Library</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Creating-and-Logging-in-as-a-new-user-on-your-local-client.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Creating-and-Logging-in-as-a-new-user-on-your-local-client</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Debugging-and-Performance-Profiling.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Debugging-and-Performance-Profiling</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Deployment-Guide.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Deployment-Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Deployment-Scratchpad.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Deployment-Scratchpad</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Developer&#39;s-Guide-to-Data-Importing.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Developer's-Guide-to-Data-Importing</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Disaster-History-Log.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Disaster-History-Log</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Disaster-Recovery-&amp;-Immediate-Response.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Disaster-Recovery-&-Immediate-Response</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Feature-Flagging.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Feature-Flagging</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Generating-Data-Dumps.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Generating-Data-Dumps</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/HOWTO:-Open-Library-Project-Management.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>HOWTO:-Open-Library-Project-Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Monitoring.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Monitoring</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Podman-(docker-alternative).html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Podman-(docker-alternative)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Processing-ONIX-Feeds.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Processing-ONIX-Feeds</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Production-Service-Architecture.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Production-Service-Architecture</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Production-Service-Architecture_old.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Production-Service-Architecture_old</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Provisioning-Guide.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Provisioning-Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Sitemap-Generation.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Sitemap-Generation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Solr.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Solr</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Using-Cache.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Using-Cache</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/Using-the-API-with-Csharp.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Using-the-API-with-Csharp</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/6_Advanced/archive.org-%E2%86%94-Open-Library-synchronisation.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>archive.org-↔-Open-Library-synchronisation</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0" data-v-51288d80 data-v-0009425e><!----><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/Coding-Recipes.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Coding-Recipes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/Developer&#39;s-Starter-Guide.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Developer's-Starter-Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/Fellowships.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Fellowships</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/History.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>History</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/Kubernetes.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Kubernetes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/openlibrary-docs/The-Lifecycle-of-a-Network-Request.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>The-Lifecycle-of-a-Network-Request</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _openlibrary-docs_6_Advanced_Deployment-Scratchpad" data-v-e6f2a212><div><h2 id="deployment-guide" tabindex="-1"><a href="https://github.com/internetarchive/openlibrary/wiki/Deployment-Guide#deploying-openlibrary" target="_blank" rel="noreferrer">Deployment Guide</a> <a class="header-anchor" href="#deployment-guide" aria-label="Permalink to &quot;[Deployment Guide](https://github.com/internetarchive/openlibrary/wiki/Deployment-Guide#deploying-openlibrary)&quot;">​</a></h2><h3 id="a-note-on-docker-compose-and-docker-compose" tabindex="-1">A note on <code>docker-compose</code> and <code>docker compose</code> <a class="header-anchor" href="#a-note-on-docker-compose-and-docker-compose" aria-label="Permalink to &quot;A note on `docker-compose` and `docker compose`&quot;">​</a></h3><p>As of early 2023, following the installation instructions on Docker&#39;s website will install either Docker Desktop, which includes Docker Compose v2, or <code>docker-ce</code> and <code>docker-compose-plugin</code> (Linux only), both of which obviate the need to install <code>docker-compose</code> v1 separately.</p><p>Further, Compose V1 will <a href="https://docs.docker.com/compose/compose-v2/" target="_blank" rel="noreferrer">no longer be supported by the end of June 2023</a> and will be removed from Docker Desktop. These directions are written for Compose V2, hence the use of <code>docker compose</code> rather than <code>docker-compose</code>. <code>docker compose</code> is <a href="https://docs.docker.com/compose/compose-v2/#differences-between-compose-v1-and-compose-v2" target="_blank" rel="noreferrer">meant to be a drop-in replacement</a> for <code>docker-compose</code>.</p><p>To see an updated document, please review <a href="https://github.com/internetarchive/openlibrary/blob/master/docker/README.md" target="_blank" rel="noreferrer">Docker Instructions</a></p><h3 id="_2021-04-21-deployment" tabindex="-1">2021-04-21 -- Deployment <a class="header-anchor" href="#_2021-04-21-deployment" aria-label="Permalink to &quot;2021-04-21 -- Deployment&quot;">​</a></h3><ul><li>[ ] Open a terminal tab and log into ol-home0</li><li>[ ] Open <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> so that you can monitor server status</li><li>[ ] <strong>Warn Slack channels <code>openlibrary</code> and <code>openlibrary-g</code> of imminent downtime!</strong></li><li>[ ] On <code>ol-home0</code> run <code>cd /opt/openlibrary &amp;&amp; sudo git pull origin master</code></li><li>[ ] On <code>ol-home0</code> run <code>/opt/openlibrary/scripts/deployment/deploy.sh</code></li><li>[ ] Run <code>./scripts/deployment/are_servers_in_sync.sh</code> to ensure the three servers are in sync. <ul><li>They were not in sync 😕 Had to git pull on ol-web2. Shouldn&#39;t be an issue after PR, I believe.</li></ul></li><li>[ ] Copy static files out Docker image and put them on <code>ol-www1</code> <strong>GO LINE BY LINE</strong></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Make a backup of static assets</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo cp -r /opt/openlibrary/openlibrary/static /opt/openlibrary/openlibrary/static_backup&#39;</span></span>
<span class="line"><span>STATIC_DIR=/tmp/ol-static-$(date &#39;+%Y-%m-%d&#39;)</span></span>
<span class="line"><span>docker cp $(docker create --rm oldev:latest):/openlibrary/static $STATIC_DIR</span></span>
<span class="line"><span>rsync -rvz $STATIC_DIR/ ol-www1:$STATIC_DIR</span></span>
<span class="line"><span># TODO: There&#39;s another static dir!</span></span>
<span class="line"><span>ssh -A ol-www1 &quot;sudo mkdir -p /opt/openlibrary/openlibrary/static-new &amp;&amp; sudo cp -r $STATIC_DIR/* /opt/openlibrary/openlibrary/static-new&quot;</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo chown -R openlibrary:openlibrary /opt/openlibrary/openlibrary/static-new&#39;</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo rm -r /opt/openlibrary/openlibrary/static &amp;&amp; sudo mv /opt/openlibrary/openlibrary/static-new /opt/openlibrary/openlibrary/static&#39;</span></span></code></pre></div><ul><li>[ ] Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh ol-web1 ol-covers0</code></li><li>[ ] Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh ol-home0 &amp;&amp; docker restart openlibrary_infobase_nginx_1</code></li><li>[ ] Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh ol-web2</code></li></ul><h3 id="_2021-04-15-deployment" tabindex="-1">2021-04-15 -- Deployment <a class="header-anchor" href="#_2021-04-15-deployment" aria-label="Permalink to &quot;2021-04-15 -- Deployment&quot;">​</a></h3><ul><li>[ ] Open a terminal tab and log into ol-home0</li><li>[ ] Open a terminal tab and log into ol-covers0</li><li>[ ] Open a terminal tab and log into ol-web1</li><li>[ ] Open <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> so that you can monitor server status</li><li>[ ] <strong>Warn Slack channels <code>openlibrary</code> and <code>openlibrary-g</code> of imminent downtime!</strong></li><li>[ ] On <code>ol-home0</code><ul><li>[ ] cd /opt/openlibrary</li><li>[ ] sudo git checkout master &amp;&amp; sudo git pull origin master</li><li>[ ] sudo make git</li><li>[ ] cd /opt/olsystem</li><li>[ ] sudo git checkout master &amp;&amp; sudo git pull origin master # -- Enter GitHub userid &amp; token</li><li>[ ] cd /opt/booklending_utils</li><li>[ ] sudo git checkout master &amp;&amp; sudo git pull origin master # -- Enter git.archive.org userid &amp; password</li><li>[ ] cd /opt/openlibrary</li></ul></li><li>[ ] Repeat the same steps on <code>ol-covers0</code> and <code>ol-web1</code> # <code>covers</code> does not need booklending_utils</li><li>[ ] Run <code>./scripts/deployment/are_servers_in_sync.sh</code> to ensure the three servers are in sync.</li><li>[ ] On <code>ol-home0</code> run <code>/opt/openlibrary/scripts/deployment/deploy.sh</code><ul><li>NOTE: Run sudo (note note: it superflously rsyncs the repos over to the other clients; we might want to rm the step? Or maybe not git pull?)</li></ul></li><li>[ ] Copy static files out Docker image and put them on <code>ol-www1</code></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Make a backup of static assets</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo cp -r /opt/openlibrary/openlibrary/static /opt/openlibrary/openlibrary/static_backup&#39;</span></span>
<span class="line"><span>STATIC_DIR=/tmp/ol-static-$(date &#39;+%Y-%m-%d&#39;)</span></span>
<span class="line"><span>docker cp $(docker create --rm oldev:latest):/openlibrary/static $STATIC_DIR</span></span>
<span class="line"><span>rsync -rvz $STATIC_DIR/ ol-www1:$STATIC_DIR</span></span>
<span class="line"><span># TODO: There&#39;s another static dir!</span></span>
<span class="line"><span>ssh -A ol-www1 &quot;sudo mkdir -p /opt/openlibrary/openlibrary/static-new &amp;&amp; sudo cp -r $STATIC_DIR/* /opt/openlibrary/openlibrary/static-new&quot;</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo chown -R openlibrary:openlibrary /opt/openlibrary/openlibrary/static-new&#39;</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo rm -r /opt/openlibrary/openlibrary/static &amp;&amp; sudo mv /opt/openlibrary/openlibrary/static-new /opt/openlibrary/openlibrary/static&#39;</span></span></code></pre></div><ul><li>[ ] Run <code>~/are_servers_in_sync.sh</code> to ensure the three servers have the same Docker latest.</li><li>[ ] Deploy to ol-web2</li></ul><h3 id="_2020-03-x" tabindex="-1">2020-03-X? <a class="header-anchor" href="#_2020-03-x" aria-label="Permalink to &quot;2020-03-X?&quot;">​</a></h3><p><strong>ADD A PIECE ON ROLLBACK WITH AND WITHOUT VOLUME MOUNTS</strong></p><ul><li><a href="https://docs.docker.com/engine/reference/commandline/tag" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/tag</a> To do a rollback on <code>ol-home0</code>:</li></ul><ol><li><code>docker image ls</code></li><li>Write down the Docker <code>IMAGE ID</code> that you want to roll back to.</li><li><code>docker tag oldev:&lt;IMAGE ID&gt; oldev:latest</code></li><li>Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code></li><li>Repeat the above steps as required on <code>ol-covers0</code>, <code>ol-web1</code>, <code>ol-web2</code></li></ol><p><strong>EnvVariable $OLDEV_DOCKER_SHA for which Docker image to use oldev:latest vs oldev:SomeSHA</strong></p><p>After deploy.sh finishes successfully,</p><ul><li>[ ] run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code> on: <ul><li>[ ] ol-home0</li><li>[ ] ol-covers0</li><li>[ ] ol-web1</li></ul></li><li>[ ] <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> ol-web1 goes green --&gt; red --&gt; green</li></ul><p>Browse <a href="http://ol-web1.us.archive.org:8080/status" target="_blank" rel="noreferrer">http://ol-web1.us.archive.org:8080/status</a> :</p><ul><li>[ ] Software version [???]</li><li>[ ] Python version 3.8.6</li><li>[ ] Host ol-web1.us.archive.org</li><li>[ ] Browse other pages of the site looking for issues</li></ul><p>Once things look stable and correct...</p><ul><li>[ ] Log out of ol-web1 and into ol-web2</li><li>[ ] Sync the repos</li><li>[ ] Run <code>~/are_servers_in_sync.sh</code> to ensure the repos and Docker latest match all other servers</li><li>[ ] Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code> on ol-web2</li><li>[ ] <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> ol-web2 goes green --&gt; red --&gt; green</li></ul><p>Broswe <a href="http://ol-web2.us.archive.org:8080/status" target="_blank" rel="noreferrer">http://ol-web2.us.archive.org:8080/status</a> :</p><ul><li>[ ] Software version [???]</li><li>[ ] Python version 3.8.6</li><li>[ ] Host ol-web2.us.archive.org</li><li>[ ] Browse other pages of the site looking for issues</li></ul><h2 id="_2021-04-08-failed" tabindex="-1">2021-04-08 -- FAILED <a class="header-anchor" href="#_2021-04-08-failed" aria-label="Permalink to &quot;2021-04-08 -- FAILED&quot;">​</a></h2><p>HALT DEPLOYMENT: docker-compose incompatibility discussed in <a href="https://github.com/internetarchive/openlibrary/issues/5007" target="_blank" rel="noreferrer">#5007</a></p><h2 id="_2021-03-24-deployment-image-id-b634610574fc-software-ver-f4f9233" tabindex="-1">2021-03-24 -- Deployment -- IMAGE ID b634610574fc -- Software ver f4f9233 <a class="header-anchor" href="#_2021-03-24-deployment-image-id-b634610574fc-software-ver-f4f9233" aria-label="Permalink to &quot;2021-03-24 -- Deployment -- IMAGE ID b634610574fc -- Software ver f4f9233&quot;">​</a></h2><ul><li>Lot&#39;s of dependency updates after turning on dependabot</li></ul><ul><li>[ ] Follow 2021-03-15 gameplan below</li></ul><hr><p>Open an ssh tunnel; i.e. ssh -L 8080:ol-web1:8080 -qAy <a href="mailto:cclauss@sshgw-sf.us.archive.org" target="_blank" rel="noreferrer">cclauss@sshgw-sf.us.archive.org</a> Then you&#39;ll be able to test at localhost:8080</p><hr><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Make a backup of static assets</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo cp -r /opt/openlibrary/openlibrary/static /opt/openlibrary/openlibrary/static_backup&#39;</span></span>
<span class="line"><span>STATIC_DIR=/tmp/ol-static-$(date &#39;+%Y-%m-%d&#39;)</span></span>
<span class="line"><span>docker cp $(docker create --rm oldev:latest):/openlibrary/static $STATIC_DIR</span></span>
<span class="line"><span>rsync -rvz $STATIC_DIR/ ol-www1:$STATIC_DIR</span></span>
<span class="line"><span># TODO: There&#39;s another static dir!</span></span>
<span class="line"><span>ssh -A ol-www1 &quot;sudo mkdir -p /opt/openlibrary/openlibrary/static-new &amp;&amp; sudo cp -r $STATIC_DIR/* /opt/openlibrary/openlibrary/static-new&quot;</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo chown -R openlibrary:openlibrary /opt/openlibrary/openlibrary/static-new&#39;</span></span>
<span class="line"><span>ssh -A ol-www1 &#39;sudo rm -r /opt/openlibrary/openlibrary/static &amp;&amp; sudo mv /opt/openlibrary/openlibrary/static-new /opt/openlibrary/openlibrary/static&#39;</span></span></code></pre></div><h2 id="_2021-03-15-deployment" tabindex="-1">2021-03-15 -- Deployment <a class="header-anchor" href="#_2021-03-15-deployment" aria-label="Permalink to &quot;2021-03-15 -- Deployment&quot;">​</a></h2><ul><li>[ ] Open a terminal tab and log into ol-home0</li><li>[ ] Open a terminal tab and log into ol-covers0</li><li>[ ] Open a terminal tab and log into ol-web1</li><li>[ ] Open <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> so that you can monitor server status</li><li>[ ] <strong>Warn Slack channels <code>openlibrary</code> and <code>openlibrary-g</code> of imminent downtime!</strong></li><li>[ ] On <code>ol-home0</code><ul><li>[ ] cd /opt/openlibrary</li><li>[ ] sudo git checkout master &amp;&amp; sudo git pull</li><li>[ ] sudo make git</li><li>[ ] cd /opt/olsystem</li><li>[ ] sudo git checkout master &amp;&amp; sudo git pull # -- Enter GitHub userid &amp; token</li><li>[ ] cd /opt/booklending_utils</li><li>[ ] sudo git checkout master &amp;&amp; sudo git pull # -- Enter git.archive.org userid &amp; password</li><li>[ ] cd /opt/openlibrary</li></ul></li><li>[ ] Repeat the same steps on <code>ol-covers0</code> and <code>ol-web1</code> # <code>covers</code> does not need booklending_utils</li><li>[ ] Run <code>~/are_servers_in_sync.sh</code> to ensure the three servers are in sync.</li><li>[ ] On <code>ol-home0</code> run <code>/opt/openlibrary/scripts/deployment/deploy.sh</code></li><li>[ ] ~Start an old-style deploy: <code>ssh -A ol-home /olsystem/bin/deploy-code openlibrary</code>~</li><li>[ ] Copy files out Docker image and put them on <code>ol-www1</code></li><li>[ ] Run <code>~/are_servers_in_sync.sh</code> to ensure the three servers have the same Docker latest.</li></ul><p><strong>ADD A PIECE ON ROLLBACK WITH AND WITHOUT VOLUME MOUNTS</strong></p><ul><li><a href="https://docs.docker.com/engine/reference/commandline/tag" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/tag</a> To do a rollback on <code>ol-home0</code>:</li></ul><ol><li><code>docker image ls</code></li><li>Write down the Docker <code>IMAGE ID</code> that you want to roll back to.</li><li><code>docker tag oldev:&lt;IMAGE ID&gt; oldev:latest</code></li><li>Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code></li><li>Repeat the above steps as required on <code>ol-covers0</code>, <code>ol-web1</code>, <code>ol-web2</code></li></ol><p><strong>EnvVariable $OLDEV_DOCKER_SHA for which Docker image to use oldev:latest vs oldev:SomeSHA</strong></p><p>After deploy.sh finishes successfully,</p><ul><li>[ ] run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code> on: <ul><li>[ ] ol-home0</li><li>[ ] ol-covers0</li><li>[ ] ol-web1</li></ul></li><li>[ ] <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> ol-web1 goes green --&gt; red --&gt; green</li></ul><p>Browse <a href="http://ol-web1.us.archive.org:8080/status" target="_blank" rel="noreferrer">http://ol-web1.us.archive.org:8080/status</a> :</p><ul><li>[ ] Software version [???]</li><li>[ ] Python version 3.8.6</li><li>[ ] Host ol-web1.us.archive.org</li><li>[ ] Browse other pages of the site looking for issues</li></ul><p>Once things look stable and correct...</p><ul><li>[ ] Log out of ol-web1 and into ol-web2</li><li>[ ] Sync the repos</li><li>[ ] Run <code>~/are_servers_in_sync.sh</code> to ensure the repos and Docker latest match all other servers</li><li>[ ] Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code> on ol-web2</li><li>[ ] <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> ol-web2 goes green --&gt; red --&gt; green</li></ul><p>Broswe <a href="http://ol-web2.us.archive.org:8080/status" target="_blank" rel="noreferrer">http://ol-web2.us.archive.org:8080/status</a> :</p><ul><li>[ ] Software version [???]</li><li>[ ] Python version 3.8.6</li><li>[ ] Host ol-web2.us.archive.org</li><li>[ ] Browse other pages of the site looking for issues</li></ul><h2 id="_2021-03-04-deployment" tabindex="-1">2021-03-04 -- Deployment... <a class="header-anchor" href="#_2021-03-04-deployment" aria-label="Permalink to &quot;2021-03-04 -- Deployment...&quot;">​</a></h2><p>Do old-style deploy EARLY</p><p>One cover job failed on an error -- Restarting the server cleaned it up.</p><p>Troubles on ol-home because of</p><ol><li>a lack of diskspace <ul><li>Remove older files from ol-home:/opt/openlibrary/deploys/openlibrary</li></ul></li><li>Problems with one or more PRs in the deployment</li></ol><h2 id="_2021-02-12-deployment" tabindex="-1">2021-02-12 -- Deployment... <a class="header-anchor" href="#_2021-02-12-deployment" aria-label="Permalink to &quot;2021-02-12 -- Deployment...&quot;">​</a></h2><blockquote><p>Check for red flags in nagios</p></blockquote><p>How do I log in???</p><p>Not confident that all repos:</p><ol><li>are set to the master branch</li><li>have no uncommitted changes</li><li><code>git pull</code> works properly</li></ol><p>Created a script in <code>~cclauss/are_repos_in_sync.sh</code> to ensure repos are all using the same SHA on all hosts</p><p>When running deploy you must enter:</p><ol><li>GitLab id and password</li><li>GitHub id and password</li></ol><p>One Docker image download failed so <code>deploy.sh</code> needed to be halted and rerun.</p><p>After deploy.sh finishes successfully, run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code> on:</p><ul><li>[ ] ol-home0</li><li>[ ] ol-covers0</li><li>[ ] ol-web1</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Creating openlibrary_covers_2    ... error</span></span>
<span class="line"><span>Creating openlibrary_memcached_1 ... done</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ERROR: for openlibrary_covers_2  Cannot create container for service covers: failed to mkdir /var/lib/docker/volumes/openlibrary_ol-vendor/_data/infogami/infogami: mkdir /var/lib/docker/volumes/openlibrary_ol-vendor/_data/infogami/infogami: file exists</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ERROR: for covers  Cannot create container for service covers: failed to mkdir /var/lib/docker/volumes/openlibrary_ol-vendor/_data/infogami/infogami: mkdir /var/lib/docker/volumes/openlibrary_ol-vendor/_data/infogami/infogami: file exists</span></span>
<span class="line"><span>Encountered errors while bringing up the project.</span></span></code></pre></div><ul><li>[ ] <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> ol-web1 goes green --&gt; red --&gt; green</li></ul><p>Broswe <code>ol-web1.us.archive.org:8080/status</code>:</p><ul><li>[x] Software version [c446875]</li><li>[x] Python version 3.8.6</li><li>[x] Host ol-web1.us.archive.org</li><li>[ ] Browse -- No covers <ul><li>Rerun <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code> on ol-covers0</li><li>Do Old-style deploy</li></ul></li></ul><p>Old-style deploy: <code>ssh -A ol-home /olsystem/bin/deploy-code openlibrary</code></p><p>Once things look stable and correct...</p><ul><li>[ ] Run <code>/opt/openlibrary/scripts/deployment/restart_servers.sh</code> on ol-web2</li><li>[ ] <a href="https://openlibrary.org/admin?stats" target="_blank" rel="noreferrer">https://openlibrary.org/admin?stats</a> ol-web2 goes green --&gt; red --&gt; green</li></ul><p>Broswe <a href="http://ol-web2.us.archive.org:8080/status" target="_blank" rel="noreferrer">http://ol-web2.us.archive.org:8080/status</a> :</p><ul><li>[x] Software version [c446875]</li><li>[x] Python version 3.8.6</li><li>[x] Host ol-web2.us.archive.org</li><li>[x] Browse -- Perfect!</li></ul><p>DONE!</p><h2 id="_2021-02-04-deployment" tabindex="-1">2021-02-04 -- Deployment... <a class="header-anchor" href="#_2021-02-04-deployment" aria-label="Permalink to &quot;2021-02-04 -- Deployment...&quot;">​</a></h2><p>DO NOT sudo bash (or rsync will be unhappy)</p><p>OL-HOME0 cd /opt/openlibrary scripts/deployment/deploy.sh Provide userid/password for git.archive.org Provide userid/token for github.com Q: Why do we get dumped into emacs? (This was sudo bash) 4 minutes to docker-compose build --pull web 32 seconds to docker-compose run -uroot --rm home make i18n REPOSITORY TAG IMAGE ID CREATED SIZE oldev 7dbe17f2a809697acf53766bd89d60443653260d 9c8a9bb06afc 37 seconds ago 2.87GB 4 minutes to gzip 1 minute per server to rsync image plus repos Need to time docker load</p><h2 id="_2021-02-02-process-to-update-the-infogami-submodule" tabindex="-1">2021-02-02 -- Process to update the infogami submodule... <a class="header-anchor" href="#_2021-02-02-process-to-update-the-infogami-submodule" aria-label="Permalink to &quot;2021-02-02 -- Process to update the infogami submodule...&quot;">​</a></h2><p>pwd # openlibrary/vendor/infogami git pull upstream master # Ensure we have the latest infogami git status cd ../.. git status git branch git checkout -b update-infogami git add vendor/infogami git status git commit -m&quot;update infogami&quot; git push --set-upstream origin update-infogami # Create a PR and merge it</p><h2 id="_2021-01-25" tabindex="-1">2021-01-25 <a class="header-anchor" href="#_2021-01-25" aria-label="Permalink to &quot;2021-01-25&quot;">​</a></h2><ul><li>Using scripts/deployment <ul><li>4-minute docker build</li><li>need to time make i18n</li><li>4-minute docker save</li><li>rsyncs fail 😦</li></ul></li></ul><h2 id="_2021-01-21" tabindex="-1">2021-01-21 <a class="header-anchor" href="#_2021-01-21" aria-label="Permalink to &quot;2021-01-21&quot;">​</a></h2><ul><li><code>solr-updater</code><ul><li>Needed <code>/opt/.petabox/dbserver</code>, with perms for openlibrary user +x.</li><li>Something weird had happened on ol-home! the .offset files had disappeared 😕 Seemed like solr-updater was stuck in a restart loop. Also infobase had been running on it for ~10h. Likely at some point the entire ol-home VM was restarted, causing supervisor to restart all the processes.</li><li>Remove the old processes from /etc/supervisor/conf.d, and ran <code>sudo supervisorctl update</code></li><li>solr-updater is running ol-home0 from 2021-01-21 ; likely missed ~10h of edits or something. No clue how long the break was.</li><li>To check last edit + offset processed by solr-updater on ol-home0: <code>docker-compose exec solr-updater cat &#39;/solr-updater-data/solr-update.offset&#39;</code></li><li>To get the last record/datetime: <code>curl -s &quot;ol-home0:7000/openlibrary.org/log/$(docker-compose exec solr-updater cat &#39;/solr-updater-data/solr-update.offset&#39;)?limit=1&quot;</code></li></ul></li><li><code>import-bot</code><ul><li>It launched ok, but we noticed that on both ol-home and ol-home0 we were getting loads of errors:</li></ul></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>l: https://openlibrary.org/api/import/ia. Response:</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:06 [178] [openlibrary.importer] [INFO] sleeping for 5 seconds before next attempt.</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.api] [INFO] POST /api/import/ia</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.importer] [WARNING] Failed to contact OL server. error=403 Client Error: Forbidden for url: https://openlibrary.org/api/import/ia. Response:</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.importer] [ERROR] failed with internal error</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.imports] [INFO] set-status professioncallgi0000luca - failed internal-error None</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.importer] [INFO] importing istanbultocairoo0000hump</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.api] [INFO] POST /api/import/ia</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.importer] [WARNING] Failed to contact OL server. error=403 Client Error: Forbidden for url: https://openlibrary.org/api/import/ia. Response:</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:11 [178] [openlibrary.importer] [INFO] sleeping for 5 seconds before next attempt.</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:16 [178] [openlibrary.api] [INFO] POST /api/import/ia</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:17 [178] [openlibrary.importer] [WARNING] Failed to contact OL server. error=403 Client Error: Forbidden for url: https://openlibrary.org/api/import/ia. Response:</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:17 [178] [openlibrary.importer] [INFO] sleeping for 5 seconds before next attempt.</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:22 [178] [openlibrary.api] [INFO] POST /api/import/ia</span></span>
<span class="line"><span>importbot_1         | 2021-01-21 18:43:22 [178] [openlibrary.importer] [WARNING] Failed to contact OL server. error=403 Client Error: Forbidden for url: https://openlibrary.org/api/import/ia. Response:</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Response: None</span></span>
<span class="line"><span>2021-01-21 18:30:31 [2374] [openlibrary.importer] [ERROR] failed with internal error</span></span>
<span class="line"><span>2021-01-21 18:30:31 [2374] [openlibrary.imports] [INFO] set-status practicalapproac0000sime_g7a3 - failed internal-error None</span></span>
<span class="line"><span>0.0 (1): UPDATE import_item SET status = &#39;failed&#39;, error = &#39;internal-error&#39;, import_time = &#39;2021-01-21T18:30:31.230473&#39;, ol_key = NULL WHERE id=2424861</span></span>
<span class="line"><span>2021-01-21 18:30:31 [2374] [openlibrary.importer] [INFO] importing catalogueofmisce00slei_5</span></span>
<span class="line"><span>2021-01-21 18:30:31 [2374] [openlibrary.api] [INFO] POST /api/import/ia</span></span>
<span class="line"><span>/opt/openlibrary/venv/local/lib/python2.7/site-packages/urllib3/util/ssl_.py:139: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings</span></span>
<span class="line"><span>  InsecurePlatformWarning,</span></span>
<span class="line"><span>2021-01-21 18:30:31 [2374] [openlibrary.importer] [WARNING] Failed to contact OL server. error=403 Client Error: Forbidden for url: https://openlibrary.org/api/import/ia. Response:</span></span>
<span class="line"><span>2021-01-21 18:30:31 [2374] [openlibrary.importer] [INFO] sleeping for 5 seconds before next attempt.</span></span>
<span class="line"><span>2021-01-21 18:30:36 [2374] [openlibrary.api] [INFO] POST /api/import/ia</span></span>
<span class="line"><span>/opt/openlibrary/venv/local/lib/python2.7/site-packages/urllib3/util/ssl_.py:139: InsecurePlatformWarning: A true SSLContext object is not available. This prevents urllib3 from configuring SSL appropriately and may cause certain SSL connections to fail. You can upgrade to a newer version of Python to solve this. For more information, see https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings</span></span>
<span class="line"><span>  InsecurePlatformWarning,</span></span>
<span class="line"><span>2021-01-21 18:30:36 [2374] [openlibrary.importer] [WARNING] Failed to contact OL server. error=403 Client Error: Forbidden for url: https://openlibrary.org/api/import/ia. Response:</span></span></code></pre></div><h2 id="_2021-01-15-deployment-steps" tabindex="-1">2021-01-15 Deployment steps <a class="header-anchor" href="#_2021-01-15-deployment-steps" aria-label="Permalink to &quot;2021-01-15 Deployment steps&quot;">​</a></h2><p>Use the scripts from <a href="https://github.com/internetarchive/openlibrary/pull/4395" target="_blank" rel="noreferrer">https://github.com/internetarchive/openlibrary/pull/4395</a></p><ol><li><strong>ol-home0</strong>: Run <code>scripts/deployment/start_production_deploy.sh</code><ul><li><strong>NOTE:</strong> Login problem with <code>booklending_utils</code> (redo manually)</li></ul></li><li><strong>ol-home0, ol-web1, ol-covers</strong>: Run <code>scripts/deployment/continue_production_deploy.sh</code><ul><li>Run the script only until just before the <code>docker-compose down</code> step.</li><li>Open <code>https://openlibrary.org/admin?stats</code></li><li>Once all three hosts are ready, run commands from <code>docker-compose down</code> to the bottom of the script.</li><li>Check <code>https://openlibrary.org/admin?stats</code> and <code>http://ol-web1.us.archive.org:8080/status</code></li></ul></li><li>Repeat step 2 only on the host <strong>ol-web2</strong></li></ol><p>NOTE: On both <code>ol-web{1, 2}</code>, the command <code>docker-compose run -uroot --rm home make i18n</code> failed with:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ERROR: An HTTP request took too long to complete. Retry with --verbose to obtain debug information.</span></span>
<span class="line"><span>If you encounter this issue regularly because of slow network conditions, consider setting</span></span>
<span class="line"><span>    COMPOSE_HTTP_TIMEOUT to a higher value (current value: 60).</span></span></code></pre></div><p>Manually re-running the command finished in a few seconds with no warnings or errors.</p><p>THINGS WE FORGOT: Old-style install on <code>ol-home</code> -- <code>ssh -A ol-home /olsystem/bin/deploy-code openlibrary</code></p><h2 id="_2021-01-09-deployment-steps" tabindex="-1">2021-01-09 Deployment steps <a class="header-anchor" href="#_2021-01-09-deployment-steps" aria-label="Permalink to &quot;2021-01-09 Deployment steps&quot;">​</a></h2><ol><li><strong>ol-home0</strong>: <code>sudo git pull origin master</code> the four repos</li><li><strong>ol-home0</strong>: build new Docker image</li><li><strong>ol-home0</strong>: docker save the image with both tags <code>:SHA</code> and <code>:latest</code><ul><li>Should we used date-time instead of <code>:SHA</code>?</li></ul></li><li><strong>ol-home0</strong>: rsync the :SHA-tagged image to ol-web{1,2}, ol-covers</li><li><strong>ol-web{1,2}, ol-covers</strong>: docker image prune &amp;&amp; docker load the image with both tags <code>:SHA</code> and <code>:latest</code></li><li><strong>ol-home0</strong>: rsync the four repos to ol-web{1,2}, ol-covers</li><li><strong>all hosts</strong>: docker-compose up the appropriate docker services for that host</li></ol><hr><p>When <code>start_production_deploy.sh</code> is run on <code>ol-home0</code> it should achieve steps 1. thru 4. above.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># https://github.com/internetarchive/openlibrary/wiki/Deployment-Scratchpad</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This script must be run on ol-home0 to start a new deployment.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ ${HOSTNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOST} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ol-home0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;FATAL: Must only be run on ol-home0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    exit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># `sudo git pull origin master` the core Open Library repos:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. https://github.com/internetarchive/olsystem</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. https://git.archive.org/jake/booklending_utils</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. https://github.com/internetarchive/openlibrary</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. https://github.com/internetarchive/infogami</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REPO_DIRS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/opt/olsystem /opt/booklending_utils /opt/openlibrary /opt/openlibrary/vendor/infogami&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REPO_DIR </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $REPO_DIRS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    cd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $REPO_DIR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># These commands were run once and probably do not need to be repeated</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root:staff</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g+w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g+s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prune</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build the oldev Docker production image</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> home</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i18n</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add a timestamp tag to the Docker image to facilitate rapid rollback</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;FROM oldev:latest&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;oldev:$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y-%m-%d_%H-%M)&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Compress the image in a .tar.gz file for transfer to other hosts</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> save</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oldev:latest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oldev_latest.tar.gz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Transfer the .tar.gz image to other hosts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REMOTE_HOSTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ol-covers0 ol-web1 ol-web2&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REMOTE_HOST </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $REMOTE_HOSTS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Starting rsync of oldev_latest.tar.gz to </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$REMOTE_HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-owner</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --group</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oldev_latest.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$REMOTE_HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:/opt/olimages/&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Finished rsync of oldev_latest.tar.gz to </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$REMOTE_HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">...&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span></code></pre></div><h2 id="_2021-01-07-deploy" tabindex="-1">2021-01-07 Deploy <a class="header-anchor" href="#_2021-01-07-deploy" aria-label="Permalink to &quot;2021-01-07 Deploy&quot;">​</a></h2><p>THINGS WE FORGOT:</p><ol><li>To down/up infobase:</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-nodemodules</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HOSTNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-deps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> infobase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> infobase_nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> affiliate-server</span></span></code></pre></div><ol start="2"><li>To check for new errors on Sentry 😅</li></ol><hr><ol><li>[ ] @mek Modify fabfile to rsync ol code repos to the new servers in their expected directories</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ol-home:/deploy/latest/opt/openlibrary</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ol-web1:/opt/openlibrary</span></span></code></pre></div><ol start="2"><li>[ ] @mek Run old-style deploy from ol-home</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ol-home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/olsystem/bin/deploy-code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary</span></span></code></pre></div><ol start="2"><li>[ ] @mek Checkout infogami 7595ae7 on ol-home</li></ol><hr><ol start="3"><li>[x] @cclauss ol-home0 pull latest code of all repo</li><li>[x] @cclauss ol-home0 build the image *1</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> home</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i18n</span></span></code></pre></div><ol start="4"><li>[x] @cclauss Create /opt/olimages for everything <ul><li>[x] ol-web1</li><li>[x] ol-web2</li><li>[x] ol-covers0</li><li>[x] @cdrini ol-home0</li></ul></li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root:staff</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g+w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g+s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span></code></pre></div><ol start="5"><li>[x] @cdrini Docker save image</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prune</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Not necessary; but cleanup</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;FROM oldev:latest&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;oldev:$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rev-parse HEAD)&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docker save oldev:latest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> oldev_latest.tar.gz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ~3 min, final file 820 MB ; image in docker container ls was 2.6 GB</span></span></code></pre></div><ol start="6"><li>[x] ~Modify fabfile to~ rsync docker image to all the hosts</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olimages</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># each takes ~18s</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rsync -a --no-owner --group --verbose oldev_latest.tar.gz </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ol-web1:/opt/olimages/&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rsync -a --no-owner --group --verbose oldev_latest.tar.gz </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ol-web2:/opt/olimages/&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rsync -a --no-owner --group --verbose oldev_latest.tar.gz </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ol-covers0:/opt/olimages/&quot;</span></span></code></pre></div><ol start="6"><li>[x] Do old style deploy using mek&#39;s code so that it doesn&#39;t try to rsync to ol-web{1,2} ol-covers0 ol-home0 *4 <ul><li>Put mek&#39;s fabfile.py changes into <code>fab_file_changes.diff</code></li></ul></li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ol-home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/olsystem/bin/deploy-code</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary</span></span></code></pre></div><ol start="6"><li>[x web1, x web2, x covers0] @cclauss git pull latest code</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olsystem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/booklending_utils</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">           &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary/vendor/infogami</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary</span></span></code></pre></div><ol start="7"><li>[x web1, x web2, x covers0] docker load on all hosts *3 <ul><li>The new docker image should have label &quot;SHA&quot; as well as &quot;latest&quot;</li></ul></li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ~2min</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docker image prune</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ~4min</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docker load </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /opt/olimages/oldev_latest.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;FROM oldev:latest&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;oldev:$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rev-parse HEAD)&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span></code></pre></div><h3 id="for-node-in-ol-web-1-2-ol-covers0" tabindex="-1">for node in ol-web{1,2} ol-covers0 <a class="header-anchor" href="#for-node-in-ol-web-1-2-ol-covers0" aria-label="Permalink to &quot;for node in ol-web{1,2} ol-covers0&quot;">​</a></h3><ol start="7"><li>[x] Down / up</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># WARNING! Moment of downtime 😬 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-nodemodules</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HOSTNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --scale</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> covers=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> covers_nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> memcached</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Remove these because they contain stale copies of the build/vendor/nodemodules files.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Want to use the files inside the docker image since it&#39;s freshly built.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NOTE: longer term, we likely don&#39;t want these volume mounted for production</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openlibrary_ol-nodemodules</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> home</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i18n</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HOSTNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-deps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span></code></pre></div><h3 id="notes" tabindex="-1">Notes <a class="header-anchor" href="#notes" aria-label="Permalink to &quot;Notes&quot;">​</a></h3><ol><li>Hit a docker error: <code>ERROR: Couldn&#39;t connect to docker daemon</code> . Was not in docker group</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Make sure you&#39;re in the docker group, to avoid sudo-ing all the docker commands</span></span>
<span class="line"><span>sudo usermod -aG docker USER_NAME</span></span>
<span class="line"><span># Exit/re-enter to take effect</span></span></code></pre></div><ol start="2"><li><p>We might want a date-based instead of SHA-based image label, so that this is more human-readable (maybe <code>date +%Y-%m-%dT%H%M</code>)</p></li><li><p>It looks like <code>docker load</code> reloads all the layers!</p></li></ol><p>Here is <code>docker image ls</code> before:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>drini@ol-web1:/opt/olimages$ docker image ls</span></span>
<span class="line"><span>REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span></span>
<span class="line"><span>oldev                latest              24e7730de44e        3 weeks ago         2.55GB</span></span>
<span class="line"><span>openlibrary/olbase   latest              7107cde0123e        4 weeks ago         2.43GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              e7ad65c36ade        5 weeks ago         2.45GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              5bc304b7af6a        6 weeks ago         2.46GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              8b9ba7350023        8 weeks ago         2.46GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              089f94fd1626        8 weeks ago         2.45GB</span></span></code></pre></div><p>It notes:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>The image oldev:latest already exists, renaming the old one with ID sha256:24e7730de44e45356224fd9ec0f58eb39ef104f5e38b28227ff100ed67a1d0f6 to empty string</span></span>
<span class="line"><span>Loaded image: oldev:latest</span></span></code></pre></div><p>After:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>drini@ol-web1:/opt/olimages$ docker image ls</span></span>
<span class="line"><span>REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE</span></span>
<span class="line"><span>oldev                latest              8b1a1ec051bf        About an hour ago   2.58GB</span></span>
<span class="line"><span>&lt;none&gt;               &lt;none&gt;              24e7730de44e        3 weeks ago         2.55GB</span></span>
<span class="line"><span>openlibrary/olbase   latest              7107cde0123e        4 weeks ago         2.43GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              e7ad65c36ade        5 weeks ago         2.45GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              5bc304b7af6a        6 weeks ago         2.46GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              8b9ba7350023        8 weeks ago         2.46GB</span></span>
<span class="line"><span>openlibrary/olbase   &lt;none&gt;              089f94fd1626        8 weeks ago         2.45GB</span></span></code></pre></div><ol start="4"><li>TODO for @cdrini: Remove all refs to ol-solr2 in olsystem</li></ol><h2 id="_2020-12-10-deploy" tabindex="-1">2020-12-10 Deploy <a class="header-anchor" href="#_2020-12-10-deploy" aria-label="Permalink to &quot;2020-12-10 Deploy&quot;">​</a></h2><p>THINGS I FORGOT TO DO:</p><ul><li><code>docker-compose run -uroot --rm home make i18n</code> (Added after-the-fact)</li></ul><ol><li>[x] On web{1,2} chown /booklending_utils</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chown</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 999:staff</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/booklending_utils</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g+w</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/booklending_utils</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/booklending_utils</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -exec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> g+s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {}</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \;</span></span></code></pre></div><ol start="2"><li>[x] Do a classic deploy so that ol-www1 has up-to-date static files <ul><li>[x] Confirm web{3,4} not restarted</li></ul></li></ol><h3 id="for-node-in-web-1-2" tabindex="-1">for node in web{1,2}: <a class="header-anchor" href="#for-node-in-web-1-2" aria-label="Permalink to &quot;for node in web{1,2}:&quot;">​</a></h3><ol><li>[x, x] Down (down first so code in memory that&#39;s currently running is not out-of-sync with what&#39;s on the filesystem)</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span></code></pre></div><ol start="2"><li>[x, x] Checkout</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/olsystem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/openlibrary/vendor/infogami</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/booklending_utils</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master</span></span></code></pre></div><ol start="3"><li>[x, x] Build</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> home</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> i18n</span></span></code></pre></div><ol start="4"><li>[x, x] Restart</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPOSE_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;docker-compose.yml:docker-compose.production.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HOSTNAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$HOSTNAME PYENV_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">3.8.6</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-deps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span></code></pre></div><p>Sort of issue? On web2, got a weird issue; <code>git pull origin master</code> was not pulling that latest infogami. We think this is because of some odd funny business with .git and /openlibrary (which contains .git) being mounted.</p><ul><li><strong>Seems like I forgot the COMPOSE_FILE</strong></li></ul><hr><p>Note: need to build to JS and everything else as well!</p><p>What is the status of <a href="https://github.com/internetarchive/openlibrary/issues/2032" target="_blank" rel="noreferrer">https://github.com/internetarchive/openlibrary/issues/2032</a> ?</p><p>Option:</p><ol><li>Merge your olsystem PR, and test running the old deploy code (should do checkout on all the nodes)</li></ol><blockquote><blockquote><ol start="2"><li>Manually do it</li></ol></blockquote></blockquote><p>Option:</p><ol><li>Try to docker save/load, and only build on ol-home <ul><li>If we didn&#39;t mount /openlibrary...</li></ul></li></ol><blockquote><blockquote><ol start="2"><li>Do it manually</li></ol></blockquote></blockquote><p>ol-www1 is what serves static files, so we need a way to build the js/css/components (inside docker), and then copy the files over to ol-www1</p><p>Creates a tar: docker save oldev:latest</p><p>??? Get to the other servers</p><p>docker load oldev.tar oldev:14f docker tag oldev:14f latest</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/openlibrary-docs/6_Advanced/Deployment-Guide.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>Deployment-Guide</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/openlibrary-docs/6_Advanced/Developer&#39;s-Guide-to-Data-Importing.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Developer's-Guide-to-Data-Importing</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"1_everyone_community-call.md\":\"D81Nk5I_\",\"1_everyone_google-summer-of-code.md\":\"D_s3pbzh\",\"1_everyone_hacktoberfest.md\":\"Cln9x4d0\",\"1_everyone_home.md\":\"70tW4Plp\",\"1_everyone_index.md\":\"CSkKJta7\",\"1_everyone_internationalization.md\":\"C5n0068W\",\"1_everyone_open-library-community-call-minutes.md\":\"Dg7FQiyU\",\"1_everyone_slack-channels.md\":\"h9YYY48T\",\"2_developers_2_frontend_frontend-guide.md\":\"B85A2hpm\",\"2_developers_2_frontend_using-vue.md\":\"BP91373s\",\"2_developers_3_backend_endpoints.md\":\"CVf7TIZK\",\"2_developers_3_backend_general.md\":\"DTkBxo73\",\"2_developers_3_backend_understanding-the-data-model.md\":\"Ce-e8PfW\",\"2_developers_3_backend_writing-bots.md\":\"BDyROxCt\",\"2_developers_contributing.md\":\"Y03TLhsJ\",\"2_developers_git-cheat-sheet.md\":\"cexXtKHd\",\"2_developers_index.md\":\"Cz7jp28V\",\"2_developers_misc_docker.md\":\"CBL1pL5i\",\"2_developers_misc_loading-production-book-data.md\":\"4iz-Oji5\",\"2_developers_misc_outdated-getting-started.md\":\"gr54fr3i\",\"2_developers_misc_searching-data-dumps-with-grep-and-jq.md\":\"4yzLUW3G\",\"2_developers_misc_testing.md\":\"ZBo9ZE3c\",\"3_designers_design-pattern-library.md\":\"DzUXOKXt\",\"4_librarians_creating-community-lists.md\":\"Du55-b0b\",\"4_librarians_guide-to-identifiers.md\":\"CEjbXawF\",\"4_librarians_library-metadata-standards.md\":\"DtP9GBXC\",\"4_librarians_mangled-marc.md\":\"B_l9qSPJ\",\"5_projects_canonical-books-page.md\":\"D_-Lm6_A\",\"5_projects_developing-the-reading-log.md\":\"BgchTE6D\",\"5_projects_documentation.md\":\"CFBj7BM3\",\"5_projects_lead_-community-coordinator.md\":\"CTW5nrbZ\",\"5_projects_lead_-community-librarian.md\":\"dh9dfDRK\",\"5_projects_library-community-congress-2019.md\":\"CufnlLxu\",\"5_projects_orphaned-editions-planning.md\":\"Cfm08vq5\",\"5_projects_wikidata-integration.md\":\"DH3JXJzv\",\"6_advanced_anti-spam-tools.md\":\"D_s4iGNL\",\"6_advanced_archive.org-↔-open-library-synchronisation.md\":\"DC87lA0c\",\"6_advanced_component-library.md\":\"fR6Kg19S\",\"6_advanced_creating-and-logging-in-as-a-new-user-on-your-local-client.md\":\"B5Pm44If\",\"6_advanced_debugging-and-performance-profiling.md\":\"C0SX8Kqc\",\"6_advanced_deployment-guide.md\":\"DQGoFKCh\",\"6_advanced_deployment-scratchpad.md\":\"DXoq1M6k\",\"6_advanced_developer's-guide-to-data-importing.md\":\"D3BMOMcb\",\"6_advanced_disaster-history-log.md\":\"FYevO4me\",\"6_advanced_disaster-recovery-_-immediate-response.md\":\"S-sAKNLe\",\"6_advanced_feature-flagging.md\":\"DDigcikr\",\"6_advanced_generating-data-dumps.md\":\"CODiqCch\",\"6_advanced_howto_-open-library-project-management.md\":\"DJcYZTP9\",\"6_advanced_index.md\":\"0KanYzdR\",\"6_advanced_monitoring.md\":\"WTeB0bQr\",\"6_advanced_podman-(docker-alternative).md\":\"DgBGlgcB\",\"6_advanced_processing-onix-feeds.md\":\"7CvTYYhP\",\"6_advanced_production-service-architecture.md\":\"DLVUXDVm\",\"6_advanced_production-service-architecture_old.md\":\"XMH9Orss\",\"6_advanced_provisioning-guide.md\":\"CQLBhswa\",\"6_advanced_sitemap-generation.md\":\"DYWbSn9F\",\"6_advanced_solr.md\":\"BBRIcpPj\",\"6_advanced_using-cache.md\":\"C4sQuPqT\",\"6_advanced_using-the-api-with-csharp.md\":\"DN0VI78R\",\"coding-recipes.md\":\"vXwh4xU_\",\"developer's-starter-guide.md\":\"CVPppFf0\",\"fellowships.md\":\"pggalBzS\",\"history.md\":\"0li5B7fk\",\"index.md\":\"LWpd28u4\",\"kubernetes.md\":\"Dtn1BxJt\",\"the-lifecycle-of-a-network-request.md\":\"Dc66gyLL\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Open Library Docs\",\"description\":\"A new docs experience for Open Library\",\"base\":\"/openlibrary-docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"}],\"search\":{\"provider\":\"local\"},\"sidebar\":[{\"text\":\"1_Everyone\",\"link\":\"/1_Everyone/index.md\",\"items\":[{\"text\":\"Community-Call\",\"link\":\"/1_Everyone/Community-Call\"},{\"text\":\"Google-Summer-of-Code\",\"link\":\"/1_Everyone/Google-Summer-of-Code\"},{\"text\":\"Hacktoberfest\",\"link\":\"/1_Everyone/Hacktoberfest\"},{\"text\":\"Home\",\"link\":\"/1_Everyone/Home\"},{\"text\":\"Internationalization\",\"link\":\"/1_Everyone/Internationalization\"},{\"text\":\"Open-Library-Community-Call-Minutes\",\"link\":\"/1_Everyone/Open-Library-Community-Call-Minutes\"},{\"text\":\"Slack-Channels\",\"link\":\"/1_Everyone/Slack-Channels\"}],\"collapsed\":true},{\"text\":\"2_Developers\",\"link\":\"/2_Developers/index.md\",\"items\":[{\"text\":\"2_Frontend\",\"items\":[{\"text\":\"Frontend-Guide\",\"link\":\"/2_Developers/2_Frontend/Frontend-Guide\"},{\"text\":\"Using-Vue\",\"link\":\"/2_Developers/2_Frontend/Using-Vue\"}],\"collapsed\":true},{\"text\":\"3_Backend\",\"items\":[{\"text\":\"Endpoints\",\"link\":\"/2_Developers/3_Backend/Endpoints\"},{\"text\":\"General\",\"link\":\"/2_Developers/3_Backend/General\"},{\"text\":\"Understanding-The-Data-Model\",\"link\":\"/2_Developers/3_Backend/Understanding-The-Data-Model\"},{\"text\":\"Writing-Bots\",\"link\":\"/2_Developers/3_Backend/Writing-Bots\"}],\"collapsed\":true},{\"text\":\"CONTRIBUTING\",\"link\":\"/2_Developers/CONTRIBUTING\"},{\"text\":\"Git-Cheat-Sheet\",\"link\":\"/2_Developers/Git-Cheat-Sheet\"},{\"text\":\"misc\",\"items\":[{\"text\":\"Docker\",\"link\":\"/2_Developers/misc/Docker\"},{\"text\":\"Loading-Production-Book-Data\",\"link\":\"/2_Developers/misc/Loading-Production-Book-Data\"},{\"text\":\"OUTDATED-Getting-Started\",\"link\":\"/2_Developers/misc/OUTDATED-Getting-Started\"},{\"text\":\"Searching-data-dumps-with-grep-and-jq\",\"link\":\"/2_Developers/misc/Searching-data-dumps-with-grep-and-jq\"},{\"text\":\"Testing\",\"link\":\"/2_Developers/misc/Testing\"}],\"collapsed\":true}],\"collapsed\":true},{\"text\":\"3_Designers\",\"items\":[{\"text\":\"Design-Pattern-Library\",\"link\":\"/3_Designers/Design-Pattern-Library\"}],\"collapsed\":true},{\"text\":\"4_Librarians\",\"items\":[{\"text\":\"Creating-Community-Lists\",\"link\":\"/4_Librarians/Creating-Community-Lists\"},{\"text\":\"Guide-to-Identifiers\",\"link\":\"/4_Librarians/Guide-to-Identifiers\"},{\"text\":\"Library-Metadata-Standards\",\"link\":\"/4_Librarians/Library-Metadata-Standards\"},{\"text\":\"Mangled-MARC\",\"link\":\"/4_Librarians/Mangled-MARC\"}],\"collapsed\":true},{\"text\":\"5_Projects\",\"items\":[{\"text\":\"Canonical-Books-Page\",\"link\":\"/5_Projects/Canonical-Books-Page\"},{\"text\":\"Developing-the-Reading-Log\",\"link\":\"/5_Projects/Developing-the-Reading-Log\"},{\"text\":\"Documentation\",\"link\":\"/5_Projects/Documentation\"},{\"text\":\"Lead:-Community-Coordinator\",\"link\":\"/5_Projects/Lead:-Community-Coordinator\"},{\"text\":\"Lead:-Community-Librarian\",\"link\":\"/5_Projects/Lead:-Community-Librarian\"},{\"text\":\"Library-Community-Congress-2019\",\"link\":\"/5_Projects/Library-Community-Congress-2019\"},{\"text\":\"Orphaned-Editions-Planning\",\"link\":\"/5_Projects/Orphaned-Editions-Planning\"},{\"text\":\"Wikidata-Integration\",\"link\":\"/5_Projects/Wikidata-Integration\"}],\"collapsed\":true},{\"text\":\"6_Advanced\",\"link\":\"/6_Advanced/index.md\",\"items\":[{\"text\":\"Anti-Spam-Tools\",\"link\":\"/6_Advanced/Anti-Spam-Tools\"},{\"text\":\"Component-Library\",\"link\":\"/6_Advanced/Component-Library\"},{\"text\":\"Creating-and-Logging-in-as-a-new-user-on-your-local-client\",\"link\":\"/6_Advanced/Creating-and-Logging-in-as-a-new-user-on-your-local-client\"},{\"text\":\"Debugging-and-Performance-Profiling\",\"link\":\"/6_Advanced/Debugging-and-Performance-Profiling\"},{\"text\":\"Deployment-Guide\",\"link\":\"/6_Advanced/Deployment-Guide\"},{\"text\":\"Deployment-Scratchpad\",\"link\":\"/6_Advanced/Deployment-Scratchpad\"},{\"text\":\"Developer's-Guide-to-Data-Importing\",\"link\":\"/6_Advanced/Developer's-Guide-to-Data-Importing\"},{\"text\":\"Disaster-History-Log\",\"link\":\"/6_Advanced/Disaster-History-Log\"},{\"text\":\"Disaster-Recovery-&-Immediate-Response\",\"link\":\"/6_Advanced/Disaster-Recovery-&-Immediate-Response\"},{\"text\":\"Feature-Flagging\",\"link\":\"/6_Advanced/Feature-Flagging\"},{\"text\":\"Generating-Data-Dumps\",\"link\":\"/6_Advanced/Generating-Data-Dumps\"},{\"text\":\"HOWTO:-Open-Library-Project-Management\",\"link\":\"/6_Advanced/HOWTO:-Open-Library-Project-Management\"},{\"text\":\"Monitoring\",\"link\":\"/6_Advanced/Monitoring\"},{\"text\":\"Podman-(docker-alternative)\",\"link\":\"/6_Advanced/Podman-(docker-alternative)\"},{\"text\":\"Processing-ONIX-Feeds\",\"link\":\"/6_Advanced/Processing-ONIX-Feeds\"},{\"text\":\"Production-Service-Architecture\",\"link\":\"/6_Advanced/Production-Service-Architecture\"},{\"text\":\"Production-Service-Architecture_old\",\"link\":\"/6_Advanced/Production-Service-Architecture_old\"},{\"text\":\"Provisioning-Guide\",\"link\":\"/6_Advanced/Provisioning-Guide\"},{\"text\":\"Sitemap-Generation\",\"link\":\"/6_Advanced/Sitemap-Generation\"},{\"text\":\"Solr\",\"link\":\"/6_Advanced/Solr\"},{\"text\":\"Using-Cache\",\"link\":\"/6_Advanced/Using-Cache\"},{\"text\":\"Using-the-API-with-Csharp\",\"link\":\"/6_Advanced/Using-the-API-with-Csharp\"},{\"text\":\"archive.org-↔-Open-Library-synchronisation\",\"link\":\"/6_Advanced/archive.org-↔-Open-Library-synchronisation\"}],\"collapsed\":true},{\"text\":\"Coding-Recipes\",\"link\":\"/Coding-Recipes\"},{\"text\":\"Developer's-Starter-Guide\",\"link\":\"/Developer's-Starter-Guide\"},{\"text\":\"Fellowships\",\"link\":\"/Fellowships\"},{\"text\":\"History\",\"link\":\"/History\"},{\"text\":\"Kubernetes\",\"link\":\"/Kubernetes\"},{\"text\":\"The-Lifecycle-of-a-Network-Request\",\"link\":\"/The-Lifecycle-of-a-Network-Request\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/internetarchive/openlibrary\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>