import{_ as a,c as t,o as n,ag as s}from"./chunks/framework.BRQrZDXk.js";const g=JSON.parse('{"title":"Creating and Logging into New Users","description":"","frontmatter":{},"headers":[],"relativePath":"6_Advanced/Creating-and-Logging-in-as-a-new-user-on-your-local-client.md","filePath":"6_Advanced/Creating-and-Logging-in-as-a-new-user-on-your-local-client.md"}'),o={name:"6_Advanced/Creating-and-Logging-in-as-a-new-user-on-your-local-client.md"};function i(r,e,p,l,c,h){return n(),t("div",null,e[0]||(e[0]=[s(`<h1 id="creating-and-logging-into-new-users" tabindex="-1">Creating and Logging into New Users <a class="header-anchor" href="#creating-and-logging-into-new-users" aria-label="Permalink to &quot;Creating and Logging into New Users&quot;">​</a></h1><p>Typically, logging into the Open Library entails cross-authenticating with an Internet Archive account. This isn&#39;t an option on the local-host, so a few work-arounds are needed to properly reproduce certain bugs.</p><p>However, all is not lost! By delving into the python shell within your web container, we can directly add users through infogami, bypassing the typical process account creation process.</p><h2 id="step-1-loading-up-infogami" tabindex="-1">Step 1: Loading up Infogami <a class="header-anchor" href="#step-1-loading-up-infogami" aria-label="Permalink to &quot;Step 1: Loading up Infogami&quot;">​</a></h2><p>First, we have to execute the Python REPL within the <code>web</code> container in Docker; one way to accomplish this is <code>docker compose exec web python</code>.</p><p>From here, we have to load up Infogami, and get it started.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>import web</span></span>
<span class="line"><span>import infogami</span></span>
<span class="line"><span>from openlibrary.config import load_config</span></span>
<span class="line"><span>load_config(&#39;conf/openlibrary.yml&#39;) # for local dev</span></span>
<span class="line"><span># load_config(&#39;/olsystem/etc/openlibrary.yml&#39;) # for prod</span></span>
<span class="line"><span>infogami._setup()</span></span>
<span class="line"><span>from infogami import config</span></span>
<span class="line"><span>from infogami.infobase import server</span></span></code></pre></div><p>These commands get the necessary portions of infogami and the open library running. (Tip: While ctrl + V does not function to paste sections of code into the python command-line, right clicking will paste whatever&#39;s stored in your clipboard. If you&#39;re on Mac, or otherwise don&#39;t have right functionality, you might have to manually enter the code. Shift+Insert will also paste on some configurations.)</p><p>To test that this is working as intended, type <code>web.ctx.site</code> into the REPL. If it doesn&#39;t show up, something has gone wrong.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt;&gt;&gt; web.ctx.site</span></span>
<span class="line"><span>&lt;infogami.infobase.client.Site object at 0x7506c00c84d0&gt;</span></span></code></pre></div><h2 id="step-2-creating-and-activating-the-account" tabindex="-1">Step 2: Creating and Activating the Account <a class="header-anchor" href="#step-2-creating-and-activating-the-account" aria-label="Permalink to &quot;Step 2: Creating and Activating the Account&quot;">​</a></h2><p>Next, we run the account creation process through the connection in <code>web.ctx.site</code>. (If you want to look further into what&#39;s being done, the relevant class is located in <code>Infogami.infobase.client.py</code>.)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&gt;&gt;&gt; web.ctx.site.register(&#39;test_username&#39;, &#39;test_displayname&#39;, &#39;test@example.com&#39;, &#39;test_password&#39;)</span></span>
<span class="line"><span>0.0 (5): SELECT * FROM store WHERE key=&#39;account/test_username&#39;</span></span>
<span class="line"><span>0.03 (2): 200 POST /openlibrary.org/account/register {&#39;username&#39;: &#39;test_username&#39;, &#39;displayname&#39;: &#39;test_displayname&#39;, &#39;email&#39;: &#39;test@example.com&#39;, &#39;password&#39;: &#39;test_password&#39;}</span></span>
<span class="line"><span>&lt;Storage {&#39;activation_code&#39;: None, &#39;email&#39;: &#39;test@example.com&#39;}&gt;</span></span></code></pre></div><p>Keep in mind the email that you use here; it&#39;ll be necessary for logging in.</p><p>Next, we have to initialize the site on the server&#39;s end, to be able to properly activate the account.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>site = server.get_site(&#39;openlibrary.org&#39;)</span></span>
<span class="line"><span>site.account_manager.activate(&lt;username&gt;)</span></span></code></pre></div><p>At this point, the account should be activated. However, we&#39;re not quite finished. In order to login, we have to edit how the program spoofs the information that would normally be returned by the internet archive.</p><h2 id="step-3-logging-in" tabindex="-1">Step 3: Logging in <a class="header-anchor" href="#step-3-logging-in" aria-label="Permalink to &quot;Step 3: Logging in&quot;">​</a></h2><p>In <code>openlibrary.plugins.upstream.account.py</code>, there should be a class called <code>xauth</code>.</p><p><img src="https://github.com/internetarchive/openlibrary/assets/131627264/439fe897-1a09-4914-b2fd-59f5ab9fd95f" alt="image"></p><p>In order to log-in to an account, result[&#39;itemname&#39;] on line 121 (on this image), must be set to the account&#39;s username that you are trying to log into.</p><p>Once this is set, you should be able to log into that account with the same email on your typical log-in screen. Remember; in order to access your admin account again, you&#39;ll have to change the item name back to <code>@openlibrary</code>.</p><h2 id="step-4-optional-adding-users-to-user-groups" tabindex="-1">Step 4 (Optional): Adding users to user groups <a class="header-anchor" href="#step-4-optional-adding-users-to-user-groups" aria-label="Permalink to &quot;Step 4 (Optional): Adding users to user groups&quot;">​</a></h2><p>Depending on the behavior that you are trying to recreate locally, it might become necessary to add your users to different user groups. For example, you may need to create merge requests using a user assigned to the librarians usergroup in order to test the merge process. The test user that you have created following the above instructions will only have basic permissions and will not be able to access librarian tools. By adding that user to the librarians usergroup, you will be able to log in as that user and access the functionality that you wish to test. With your local development instance running, the list of all usergroups can be viewed at <a href="http://localhost:8080/usergroup" target="_blank" rel="noreferrer">http://localhost:8080/usergroup</a>.</p><p><img src="https://github.com/user-attachments/assets/d28a9e81-63d9-4f7c-acae-a0df5d6796db" alt="Screenshot of the open library usergroup page"></p><p>Following the librarian user example, we can find the librarians usergroup page at <a href="http://localhost:8080/usergroup/librarians" target="_blank" rel="noreferrer">http://localhost:8080/usergroup/librarians</a>. To add a user to a specific usergroup, open the page for that group from the list pictured above and append, <code>?m=edit</code>, to the end of the url. This will load the edit form for that usergroup which will allow you to add your newly created user.</p><p><img src="https://github.com/user-attachments/assets/e6146d93-6319-41ab-8605-9b9764f50afd" alt="Screenshot of the edit page for the librarians usergroup page"></p><p>In the above screenshot, the librarians usergroup is being edited at the url, <a href="http://localhost:8080/usergroup/librarians?m=edit" target="_blank" rel="noreferrer">http://localhost:8080/usergroup/librarians?m=edit</a>. To add your user, in the members section, enter <code>/people/</code> followed by the user&#39;s screen name (<code>/people/test_username</code> for the user, <code>test_username</code>, in the above example) and then click save once you are finished. After saving your changes, any valid users that you have added should now be added to that specific usergroup. You can verify this by logging in as that user and ensuring that the appropriate pages for that usergroup are now accessible. You can also check by navigating to the newly updated usergroup page to see if the user appears in the list of usergroup members.</p><p><img src="https://github.com/user-attachments/assets/aac8f287-e2ba-4db3-8ba2-5850cbaca9c8" alt="Screenshot of the librarians usergroup page with the newly added test user in the list of members"></p>`,29)]))}const u=a(o,[["render",i]]);export{g as __pageData,u as default};
