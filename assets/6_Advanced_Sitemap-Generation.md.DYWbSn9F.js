import{_ as s,c as e,o as i,ag as t}from"./chunks/framework.BRQrZDXk.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"6_Advanced/Sitemap-Generation.md","filePath":"6_Advanced/Sitemap-Generation.md"}'),n={name:"6_Advanced/Sitemap-Generation.md"};function p(r,a,l,o,h,d){return i(),e("div",null,a[0]||(a[0]=[t(`<p>See original documentation at: <a href="http://gio.blog.archive.org/2015/02/02/ol-sitemap-generation/" target="_blank" rel="noreferrer">http://gio.blog.archive.org/2015/02/02/ol-sitemap-generation/</a><a href="http://gio.blog.archive.org/2015/02/04/ol-how-to-generate-the-sitemaps/" target="_blank" rel="noreferrer">http://gio.blog.archive.org/2015/02/04/ol-how-to-generate-the-sitemaps/</a></p><h2 id="data-dumps" tabindex="-1">Data Dumps <a class="header-anchor" href="#data-dumps" aria-label="Permalink to &quot;Data Dumps&quot;">​</a></h2><p>Sitemaps are generated on <code>ol-home</code> using the latest data dump <code>ol_dump.txt.gz</code> as the source file. See <a href="./Generating-Data-Dumps.html">Generating Data Dumps</a> for more on generating <code>ol_dump</code></p><p>The last dump is available at: <a href="http://openlibrary.org/data/ol_dump_works_latest.txt.gz" target="_blank" rel="noreferrer">http://openlibrary.org/data/ol_dump_works_latest.txt.gz</a> for more details, you can see <a href="https://openlibrary.org/developers/dumps" target="_blank" rel="noreferrer">https://openlibrary.org/developers/dumps</a>.</p><h2 id="generating-sitemaps" tabindex="-1">Generating Sitemaps <a class="header-anchor" href="#generating-sitemaps" aria-label="Permalink to &quot;Generating Sitemaps&quot;">​</a></h2><p>To generate the Sitemap, execute this code on ol-home:</p><pre><code>ssh ol-home
cd /1/var/tmp  # this way you can rsync it from rsync://ol-home/var_1/tmp/
python /1/var/lib/openlibrary/deploy/openlibrary/openlibrary/data/sitemap.py ol_dump_works_latest.txt.gz
# or is this the right script? /opt/openlibrary/openlibrary/scripts/2009/01/sitemaps/sitemap.py
</code></pre><h2 id="making-sitemaps-live" tabindex="-1">Making Sitemaps Live <a class="header-anchor" href="#making-sitemaps-live" aria-label="Permalink to &quot;Making Sitemaps Live&quot;">​</a></h2><p>After the sitemap is generated you need to place it in /1/var/lib/openlibrary/sitemaps as defined in /olsystem/etc/nginx/sites-available/openlibrary.conf on ol-www1.</p><pre><code>location ~ ^/static/(docs|tour|sitemaps|jsondumps|images/shelfview|sampledump.txt.gz)(/.*)?$ {
    root /1/var/lib/openlibrary/sitemaps;
    autoindex on;
    rewrite ^/static/(.*)$ /$1 break;
}
</code></pre><p>You can do this using rsync:</p><pre><code>sudo rsync -av rsync://ol-home/var_1/tmp/sitemaps/sitemaps /1/var/lib/openlibrary/sitemaps/
</code></pre><h2 id="verify-sitemaps-available" tabindex="-1">Verify Sitemaps Available <a class="header-anchor" href="#verify-sitemaps-available" aria-label="Permalink to &quot;Verify Sitemaps Available&quot;">​</a></h2><pre><code>curl -I https://openlibrary.org/static/sitemaps/siteindex.xml.gz

HTTP/1.1 200 OK
Server: nginx/1.1.19
Date: Wed, 04 Feb 2015 16:48:50 GMT
Content-Type: text/plain
Content-Length: 14689
Last-Modified: Wed, 04 Feb 2015 12:48:06 GMT
Connection: keep-alive
Accept-Ranges: bytes
</code></pre><h2 id="verify-sitemaps-have-been-copied-to-appropriate-hosts" tabindex="-1">Verify Sitemaps have been copied to appropriate hosts <a class="header-anchor" href="#verify-sitemaps-have-been-copied-to-appropriate-hosts" aria-label="Permalink to &quot;Verify Sitemaps have been copied to appropriate hosts&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SITEINDEX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/1/var/lib/openlibrary/sitemaps/sitemaps/siteindex.xml.gz&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SERVERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ol-covers0 ol-www0&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SERVER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $SERVERS; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LAST_UPDATED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $SERVER </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --time-style=long-iso</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $SITEINDEX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Sitemaps on </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SERVER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> were last updated on \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LAST_UPDATED</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Ensure that the file dates on servers (</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$SERVERS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">) are the first day of the current month.&quot;</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Sitemaps on ol-covers0 were last updated on 2023-07-01.</span></span>
<span class="line"><span>Sitemaps on ol-www0 were last updated on 2023-07-01.</span></span>
<span class="line"><span>Ensure that the file dates on servers (ol-covers0 ol-www0) are the first day of the current month.</span></span></code></pre></div>`,17)]))}const g=s(n,[["render",p]]);export{c as __pageData,g as default};
