import{_ as o,c as i,o as n,ag as r,j as t,a,t as s}from"./chunks/framework.BRQrZDXk.js";const g=JSON.parse(`{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"Developer's-Starter-Guide.md","filePath":"Developer's-Starter-Guide.md"}`),l={name:"Developer's-Starter-Guide.md"};function h(p,e,d,c,m,b){return n(),i("div",null,[e[10]||(e[10]=r(`<h2 id="audience" tabindex="-1">Audience <a class="header-anchor" href="#audience" aria-label="Permalink to &quot;Audience&quot;">​</a></h2><p>The intended audience of this guide are <strong>first time contributors</strong> who are trying to understand the Open Library codebase.</p><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><p>Before starting this guide, it is recommended that you have:</p><ol><li><a href="https://github.com/internetarchive/openlibrary.git" target="_blank" rel="noreferrer">cloned</a> or <a href="https://github.com/internetarchive/openlibrary/fork" target="_blank" rel="noreferrer">forked</a> and pulled an up-to-date version of the Open Library repository</li><li>successfully launched your local environment using the <a href="https://github.com/internetarchive/openlibrary/tree/master/docker#readme" target="_blank" rel="noreferrer">docker guide</a></li><li>completed the <a href="https://github.com/internetarchive/openlibrary/wiki/Git-Cheat-Sheet" target="_blank" rel="noreferrer">git cheat sheet</a> tutorial</li><li>found a <a href="https://github.com/internetarchive/openlibrary/issues?q=is%3Aissue+is%3Aopen+-linked%3Apr+label%3A%22Good+First+Issue%22+no%3Aassignee" target="_blank" rel="noreferrer">good first issue</a> to work on</li></ol><p>Now you&#39;re ready to understand how the code is structured within Open Library.</p><h2 id="approach" tabindex="-1">Approach <a class="header-anchor" href="#approach" aria-label="Permalink to &quot;Approach&quot;">​</a></h2><p>Working backwards from what you see on the site. In this guide, we&#39;re going to work backwards from what visitors see on the Open Library website and then explore the sequence of actions (the &quot;lifecycle&quot;) that takes place in order for the html to be served.</p><h2 id="the-anatomy-of-the-site" tabindex="-1">The Anatomy of the Site <a class="header-anchor" href="#the-anatomy-of-the-site" aria-label="Permalink to &quot;The Anatomy of the Site&quot;">​</a></h2><h3 id="html-templates" tabindex="-1">HTML Templates <a class="header-anchor" href="#html-templates" aria-label="Permalink to &quot;HTML Templates&quot;">​</a></h3><p>When a patron navigates through the Open Library website and requests pages (like the screenshot pictured below), the patron will be served &quot;rendered&quot; html content from the <a href="https://github.com/internetarchive/openlibrary/tree/master/openlibrary/templates" target="_blank" rel="noreferrer"><code>openlibrary/templates</code></a> directory.</p><img width="500" alt="Screenshot 2024-09-04 at 6 12 47 AM" src="https://github.com/user-attachments/assets/8f8de2d6-e255-492d-8552-3e11b69c50fc"><p>Here are a few examples of common templates:</p><ul><li>Homepage: <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/home/index.html" target="_blank" rel="noreferrer"><code>home/index.html</code></a>, which gets rendered <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/plugins/openlibrary/home.py#L52" target="_blank" rel="noreferrer">here</a></li><li>Books Page(s): <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/type/edition/view.html" target="_blank" rel="noreferrer"><code>type/edition/view.html</code></a> for both editions (e.g. <a href="https://openlibrary.org/books/OL30162974M" target="_blank" rel="noreferrer">https://openlibrary.org/books/OL30162974M</a>) or works (<a href="https://openlibrary.org/works/OL257943W" target="_blank" rel="noreferrer">https://openlibrary.org/works/OL257943W</a>),</li><li>Subjects Page(s): <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/subjects.html" target="_blank" rel="noreferrer"><code>subjects.html</code></a> (e.g. openlibrary.org/subjects/climbing)</li><li>Search: <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/work_search.html" target="_blank" rel="noreferrer"><code>work_search.html</code></a> (e.g. openlibrary.org/search)</li><li>Login &amp; Register: <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/login.html" target="_blank" rel="noreferrer"><code>login.html</code></a> and <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/account/create.html" target="_blank" rel="noreferrer"><code>account/create.html</code></a></li></ul><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>Some pages, like the /books page, are first-class &quot;registered&quot; <a href="https://openlibrary.org/dev/docs/infogami" target="_blank" rel="noreferrer">Infogami</a> <a href="https://github.com/internetarchive/openlibrary/tree/master/openlibrary/templates/type" target="_blank" rel="noreferrer"><code>types</code></a> and are powered through the Infogami wiki framework that runs Open Library. This is true for <code>books</code>, <code>authors</code>, <code>lists</code>, and a few other types. Because these are first-class registered types handled by infogami, You won&#39;t find <a href="https://github.com/internetarchive/openlibrary/tree/master/openlibrary/plugins" target="_blank" rel="noreferrer">plugin</a> controllers for them in Open Library. Their html templates can be found in the special <a href="https://github.com/internetarchive/openlibrary/tree/master/openlibrary/templates/type" target="_blank" rel="noreferrer"><code>templates/type</code></a> directory. When Open Library notices a url containing a key for one of these special types, infogami fetches the corresponding object from the database and passes it as <code>page</code> straight into the template. So for the books page, which is <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/type/edition/view.html" target="_blank" rel="noreferrer"><code>templates/type/edition/view.html</code></a>, the <code>page</code> value defined in its <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/type/edition/view.html#L1" target="_blank" rel="noreferrer"><code>$def with (page, ...)</code></a> header is actually a <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/plugins/upstream/models.py#L44" target="_blank" rel="noreferrer"><code>book</code> edition or work object</a> whose properties are defined <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/plugins/upstream/models.py#L44" target="_blank" rel="noreferrer">here</a>.</p></div><p>You may notice that most the html pages within the templates folder don&#39;t include the <code>&lt;html&gt;</code>, <code>&lt;head&gt;</code>, and <code>&lt;footer&gt;</code> sections of the website, just the contents of the body. This is because Open Library is set up such that nearly all <code>page</code> templates get automatically wrapped by the <a href="https://github.com/internetarchive/openlibrary/tree/master/openlibrary/templates/site.html" target="_blank" rel="noreferrer"><code>site</code></a> template.</p><h3 id="the-site-wrapper" tabindex="-1">The Site Wrapper <a class="header-anchor" href="#the-site-wrapper" aria-label="Permalink to &quot;The Site Wrapper&quot;">​</a></h3><p>While the body of each Open Library page may present differently, most pages share similar scaffolding, look, and feel. For instance, nearly every page will have:</p><p><a id="site-subtemplate-examples"></a></p><ol><li>A top black bar <a href="./openlibrary/templates/site/alert.html"><code>topNotice</code></a> with an Internet Archive logo:<br><img width="500" alt="Screenshot 2024-09-04 at 6 26 30 AM" src="https://github.com/user-attachments/assets/395c2406-b297-4b9d-bb02-6aee85cc6fb2"></li><li>A header <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/lib/nav_head.html" target="_blank" rel="noreferrer"><code>header#header-bar</code></a> section with the Open Library logo, a search box, a hamburger menu, and an account dropper for logged in patrons:<br><img width="500" alt="Screenshot 2024-09-04 at 6 27 23 AM" src="https://github.com/user-attachments/assets/a3c9380e-83f8-49e4-8681-8f7379843fc4"></li><li>A <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/lib/nav_foot.html" target="_blank" rel="noreferrer"><code>footer</code></a> menu:<br><img width="500" alt="Screenshot 2024-09-04 at 6 27 53 AM" src="https://github.com/user-attachments/assets/c5748e17-ae40-4cc7-97ab-5c6230cc12ec"></li></ol><p>The top-level html page that is used to define and render the overall structure of every Open Library page is <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/site.html" target="_blank" rel="noreferrer"><code>templates/site.html</code></a>. In its definition, this main <code>site</code> template calls out to other modular, specific &quot;sub-templates&quot; (such as the <a href="./site-subtemplate-examples.html">3 described above</a>) defined within the <code>templates/site</code> and <code>templates/lib</code> directories, which combine to form the &quot;site&quot;. You can <a href="https://webpy.org/cookbook/layout_template" target="_blank" rel="noreferrer">read more</a> about this &quot;layout template&quot; philosophy in the official web.py documentation, the micro web framework used by Open Library.</p><p>The variable section of the <code>site</code> that changes depending on the requested <code>page</code> is the <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/site/body.html#L39" target="_blank" rel="noreferrer"><code>body</code></a>. This <code>page</code> is an html template that gets passed in to the <code>site</code>. You may wish to review examples in the <a href="#Page_Templates">Page Templates</a> section.</p><h3 id="how-a-page-gets-rendered" tabindex="-1">How a Page Gets Rendered <a class="header-anchor" href="#how-a-page-gets-rendered" aria-label="Permalink to &quot;How a Page Gets Rendered&quot;">​</a></h3><p>When we want to serve a rendered template to a visitor, we typically use the <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/plugins/openlibrary/home.py#L52" target="_blank" rel="noreferrer"><code>render_template()</code></a> function. The first argument of <code>render_template</code> will be be the name of the page-specific html template we want to be rendered and injected into the <code>site</code> body. The rest of the parameters to <code>render_template</code>, after the filename of the template, are used to pass variables from python into the corresponding html template file, as defined in the template&#39;s header.</p><p>For instance, imagine we have a simple template called <code>templates/book.html</code> which requires a <code>book_title</code>, a <code>bookcover_url</code>, and an <code>author_name</code>. Such a template might look like:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>$def with (book_title, bookcover_url, author=None)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;div&gt;</span></span>
<span class="line"><span>  &lt;h1&gt;$book_title&lt;/h1&gt;</span></span>
<span class="line"><span>  &lt;img src=&quot;$bookcover_url&quot;/&gt;</span></span>
<span class="line"><span>  $if author:</span></span>
<span class="line"><span>    &lt;h2&gt;$author&lt;/h2&gt;</span></span>
<span class="line"><span>&lt;/div&gt;</span></span></code></pre></div><p>The <code>$def with(...)</code> line is how the template declares what variables it needs to be passed in when it is being called and rendered. Elsewhere in the template, the <code>$</code> symbol acts as an instruction that a variable should be replaced by its value when it&#39;s being rendered.</p><p>Check the <a href="https://webpy.org/docs/0.3/templetor" target="_blank" rel="noreferrer">official web.py templator documentation</a> if you&#39;d like a deep dive into all the capabilities of Open Library&#39;s python-powered templating system.</p><div class="caution custom-block github-alert"><p class="custom-block-title">CAUTION</p><p>The <code>$:</code> combination instructs the template to render this variable as html, as opposed to plaintext. This is sometimes necessary when rendering one html template from another, but should be done with care when rendering a variable whose value may be user-specified because this may result in dangerous <a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank" rel="noreferrer">XSS attacks</a>, where a bad actor may intentionally save javascript code into a variable, hoping that the website will render and execute this code as html as opposed to safe plaintext.</p></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>Notice that <code>author</code> in this example is provided as a keyword argument with a default value of <code>None</code> and thus is optional when the template is being called. Similar to when defining a python function, once a keyword argument is defined, all following variables after it must also then be keyword arguments.</p></div><p>From python, the corresponding code to render this <code>templates/books.html</code> template would be:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>render_template(</span></span>
<span class="line"><span>  &#39;books&#39;,  # name of the template in templates/ directory without .html</span></span>
<span class="line"><span>  book_title=&quot;The Hobbit&quot;,</span></span>
<span class="line"><span>  bookcover_url=&quot;https://covers.openlibrary.org/b/id/14624642-L.jpg&quot;,</span></span>
<span class="line"><span>  author=&quot;J.R.R. Tolkien&quot;</span></span>
<span class="line"><span>)</span></span></code></pre></div><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>When we call <code>render_template</code>, it knows to look in the <code>templates/</code> directory and so we don&#39;t need to specify this. Also, we don&#39;t need to include the <code>.html</code> extension.</p></div><p>When we call <code>render_template(&#39;book&#39;, ...)</code> we are fetching the <code>templates/book.html</code> template and passing in the values <code>book_title</code>, <code>bookcover_url</code>, and <code>author</code> from python into the template&#39;s <code>$def with (...)</code> section, where it can be substituted as needed into the <code>$variables</code> in the template. The <code>render_template</code> takes this prepared <code>book</code> template and then passes it into <code>site.html</code> where it will be forwarded to the <a href="https://github.com/internetarchive/openlibrary/blob/master/openlibrary/templates/site/body.html#L39" target="_blank" rel="noreferrer"><code>body</code></a> to be rendered.</p><h2 id="managing-large-templates" tabindex="-1">Managing Large Templates <a class="header-anchor" href="#managing-large-templates" aria-label="Permalink to &quot;Managing Large Templates&quot;">​</a></h2><p>When a single template becomes too large and unmanageable, or when the programmer recognizes an opportunity to clean up a template by factoring-out common or shared pieces of logic, they may choose to break a template into smaller logical components and move them into their own separate micro-templates. These micro-templates can live beside other templates in the <code>templates/</code> directory. If these micro-templates are very self-contained and make sense to be rendered as their own widget, such the <code>QueryCarousel</code>, you might consider saving your template in the <code>macros</code> directory, which is folder of templates that have a few additional special properties.</p><h2 id="macros" tabindex="-1"><a href="https://openlibrary.org/dev/docs/infogami#anchor7" target="_blank" rel="noreferrer">Macros</a> <a class="header-anchor" href="#macros" aria-label="Permalink to &quot;[Macros](https://openlibrary.org/dev/docs/infogami#anchor7)&quot;">​</a></h2>`,37)),t("p",null,[e[0]||(e[0]=a("When refactoring programmer may decide it makes sense to move the code to the ")),e[1]||(e[1]=t("code",null,"macros",-1)),e[2]||(e[2]=a(" directory. A ")),e[3]||(e[3]=t("code",null,"macro",-1)),e[4]||(e[4]=a(" is simply a special type of ")),e[5]||(e[5]=t("code",null,"template",-1)),e[6]||(e[6]=a(" that can be accessed using ")),t("code",null,s(),1),e[7]||(e[7]=a(" syntax by the page editor in Open Library. You can read more about macros in our very stale/outdated ")),e[8]||(e[8]=t("a",{href:"https://openlibrary.org/dev/docs/infogami#anchor7",target:"_blank",rel:"noreferrer"},"infogami documentation",-1)),e[9]||(e[9]=a("."))]),e[11]||(e[11]=r('<p>Here&#39;s what the infogami edit UI looks like for a collection: <img width="610" alt="Screenshot 2024-09-04 at 8 31 02 AM" src="https://github.com/user-attachments/assets/a74e9582-5cc4-456b-bcdd-b5fcde5f50c7"></p><p>Here&#39;s what the page looks like when it&#39;s rendered with a macro: <img width="624" alt="Screenshot 2024-09-04 at 8 31 28 AM" src="https://github.com/user-attachments/assets/1b72db4e-8258-40f4-aa8c-206ffc82d5bc"></p><h2 id="next-understanding-controllers-routers" tabindex="-1">Next: Understanding controllers &amp; routers <a class="header-anchor" href="#next-understanding-controllers-routers" aria-label="Permalink to &quot;Next: Understanding controllers &amp; routers&quot;">​</a></h2><p>So far, by extrapolating from what&#39;s written in this guide, we hope you&#39;ve learned how you may be able to:</p><ol><li>Find the corresponding html template file for an Open Library webpage somewhere in the <code>templates/</code> directory</li><li>How to make a change to the site wrapper, should you need to e.g. change the header or footer</li><li>In theory, add a new template and render it... But from where?</li></ol><p>The next step is learning where to add our <code>render_template(...)</code> code and how to connect a url that a patron visits with logic to respond to this request.</p><p>To answer this question, you&#39;ll want to proceed to the <a href="https://github.com/internetarchive/openlibrary/tree/master/openlibrary/plugins#readme" target="_blank" rel="noreferrer">Plugins Guide</a>.</p>',7))])}const f=o(l,[["render",h]]);export{g as __pageData,f as default};
